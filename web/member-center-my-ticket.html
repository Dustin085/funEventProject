<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員中心</title>
    <link rel="stylesheet" href="./assets/css/styleByDustin.css">
    <link rel="stylesheet" href="./assets/css/styleByKuokuo.css">
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- axios -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.5/axios.min.js"
        integrity="sha512-01Pe9P3mJM/4c80VuoYEGHlspKGbd9uWQe9HtdLsdTqV0CS1kz8ca44sinVEXEvlZNciMmsAjeEbm5ZxHC7yYg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- funevent的react元件 -->
    <script type="text/babel" src="https://dustin085.github.io/funEventProject/web/assets/js/Topbar.jsx"></script>
    <script type="text/babel" src="https://dustin085.github.io/funEventProject/web/assets/js/Footer.jsx"></script>
    <script type="text/babel" src="https://dustin085.github.io/funEventProject/web/assets/js/FloatBtnBox.jsx"></script>
    <script type="text/babel"
        src="https://dustin085.github.io/funEventProject/web/assets/js/MemberCenterSidebar.jsx"></script>
    <script type="text/babel" src="https://dustin085.github.io/funEventProject/web/assets/js/FuneventTag.jsx"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">


        function App() {
            const { useState, useEffect, useRef } = React;
            // 重要，裝有會員中心子頁的id
            const subPageIdRef = useRef("my-ticket");
            // 子頁id轉標題
            const [subPageIdToTcTitle, setSubPageIdToTcTitle] = useState([]);
            useEffect(() => {
                // 抓id轉標題的json
                axios.get("https://dustin085.github.io/funEventProject/web/assets/json/memberCenterSubPageIdToTitle.json")
                    .then((response) => setSubPageIdToTcTitle(response.data))
                    .catch((error) => console.log(error));
            }, []);
            // 接收到id轉標題後再改變標題
            useEffect(() => {
                subPageIdToTcTitle.forEach((item) => {
                    if (item.id == subPageIdRef.current) {
                        document.title = `會員中心-${item.tcTitle}`;
                    }
                });
            }, [subPageIdToTcTitle]);

            // 管理電子票疊層
            const [isDigitalTicketOverlayActive, setIsDigitalTicketOverlayActive] = useState(false);
            const openDigitalTicketOvarlay = () => {
                setIsDigitalTicketOverlayActive(true);
            };

            return <>
                {/*為背景設計的wrap，直接讓body{overflow:hidden}在手機板會失效*/}
                <div className="funevent-wrap">
                    <Topbar noLocationSelector />
                    <div className="member-center-bg-color-block">
                        <div className="member-center-bg-color-block__block1"></div>
                        <div className="member-center-bg-color-block__block2"></div>
                        <div className="member-center-bg-color-block__block3"></div>
                        <div className="member-center-bg-color-block__block4"></div>
                    </div>
                    <FloatBtnBox />
                    {/* 電子票QRcode展示疊層 */}
                    <DigitalTicketOverlay isActiveProps={isDigitalTicketOverlayActive} setIsActiveProps={setIsDigitalTicketOverlayActive} />
                    <main>
                        <section id="member-center">
                            {/* 會員中心-側邊列 */}
                            <MemberCenterSidebar subPage={subPageIdRef.current} />

                            {/* 分頁內容寫在這邊 */}
                            <div className="member-center-content member-center-myticket">
                                <div className="all-iten">
                                    <h3 className="title">我的票卷</h3>
                                    <div className="selection-and-filter">
                                        <ul className="selection-bar-all">
                                            <li><a href="#" className="selection-bar">即將到來</a></li>
                                            <li><a href="#" className="selection-bar">歷史紀錄</a></li>
                                            <li><a href="#" className="selection-bar">取消中/已取消</a></li>
                                        </ul>
                                        <div className="choose">
                                            <li href="#">從新到舊</li>
                                            <button className="filter"></button>
                                        </div>
                                    </div>

                                    <div className="event">
                                        <div className="event-pic"></div>
                                        <div className="event-info-address-button">

                                            <div>

                                            </div><div className="tickets">
                                                <p>共兩張</p>
                                            </div>

                                            <div className="event-info-and-button">
                                                <div className="event-information">
                                                    <small>2024.10.06(日)</small>
                                                    <h3>流行音樂與民謠吉他-第一堂吉他課的首選</h3>
                                                    <p>親子一同彈:上午場x1</p>
                                                </div>
                                                <div className="address-and-button">
                                                    <div className="address-pin">
                                                        <div className="pin"></div>
                                                        <small>臺北市中山區搖滾路一段321號</small>
                                                    </div>
                                                    <div className="two-button">
                                                        <button className="button-order">訂單詳情</button>
                                                        <button className="button-order" onClick={openDigitalTicketOvarlay}>
                                                            <img src="./assets/images/icon-new/電子票.svg" alt="電子票" />
                                                            電子票
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </main>
                    <Footer />
                </div>
            </>
        }

        function DigitalTicketOverlay({ isActiveProps = false, setIsActiveProps = null }) {
            const overlayBgRef = useRef(null);
            const digitalTicketOverlayRef = useRef(null);
            const [isActive, setIsActive] = useState(isActiveProps);
            useEffect(() => {
                if (isActive) {
                    $(overlayBgRef.current).stop().fadeIn();
                    $(digitalTicketOverlayRef.current).stop().fadeIn();
                } else {
                    $(overlayBgRef.current).stop().fadeOut();
                    $(digitalTicketOverlayRef.current).stop().fadeOut();
                }
                // 同步父元件的state
                setIsActiveProps(isActive);
            }, [isActive]);

            useEffect(() => {
                // 把props同步給state
                setIsActive(isActiveProps);
            }, [isActiveProps]);

            const closeOverlayHandler = () => {
                setIsActive(false);
            };
            return <>
                <div className="overlay-bg" onClick={closeOverlayHandler} ref={overlayBgRef}></div>
                <div className="digital-ticket-overlay" ref={digitalTicketOverlayRef}>
                    <div className="wrap">
                        <div className="start-box">
                            <button type="button" className="close-btn" onClick={closeOverlayHandler}></button>
                            <div className="ticket-num-indicator">1/2</div>
                            <div className="QRcode-box">
                                <button type="button" className="prev-btn"></button>
                                <figure className="QRcode"><img src="./assets/images/ticket-QRcode.png" alt="" /></figure>
                                <button type="button" className="next-btn"></button>
                            </div>
                            <div className="timer">截圖無效 <Timer totalTime={120} timeUpFuntion={closeOverlayHandler} isActive={isActive} /></div>
                        </div>
                        <div className="end-box">
                            <div className="split-line-row"></div>
                            <div className="date">2024.10.06(日)</div>
                            <div className="title-box">
                                <h3 className="title">流行音樂與民謠吉他-第一堂吉他課的首選</h3>
                                <p className="subtitle">親子一同彈:上午場</p>
                            </div>
                            <p className="ticket-code-num">票卷編號:61561561606150</p>
                        </div>
                    </div>
                </div>
            </>
        }

        function Timer({ totalTime = 60, timeUpFuntion = null, isActive }) {
            // timeUpFunction => 時間到的時候會觸發的函式。利用isActive來判斷開關
            // totalTime單位是秒
            const [leftTime, setLeftTime] = useState(Number(totalTime));
            const timerTimeoutId = useRef(null);
            useEffect(() => {
                if (isActive) {
                    setLeftTime(totalTime);
                } else {
                    // 離開的時候記得關掉計時器
                    clearTimeout(timerTimeoutId.current);
                }
            }, [isActive]);
            useEffect(() => {
                if (leftTime === 0) {
                    timeUpFuntion();
                }
                timerTimeoutId.current = setTimeout(() => {
                    setLeftTime(leftTime - 1);
                }, 1000);
            }, [leftTime]);
            return (
                <span>{Math.floor(leftTime / 60)}:{(leftTime % 60).toString().padStart(2, 0)}</span>
            )
        }




        ReactDOM
            .createRoot(document.getElementById("root"))
            .render(<App />);
    </script>
</body>

</html>